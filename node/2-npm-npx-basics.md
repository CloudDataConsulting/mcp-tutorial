# npm and npx Fundamentals for MCP Development

## Table of Contents
- [What are npm and npx](#what-are-npm-and-npx)
- [Installing Packages](#installing-packages)
- [Understanding package.json and package-lock.json](#understanding-packagejson-and-package-lockjson)
- [Common npm Commands](#common-npm-commands)
- [The node_modules Directory](#the-node_modules-directory)
- [Global vs Local Packages](#global-vs-local-packages)
- [Using npx for Executables](#using-npx-for-executables)
- [Publishing and Using Executable Packages](#publishing-and-using-executable-packages)
- [MCP-Specific Examples](#mcp-specific-examples)

## What are npm and npx

### npm (Node Package Manager)
npm is the default package manager for Node.js. It handles:
- Installing and managing dependencies
- Running scripts defined in package.json
- Publishing packages to the npm registry
- Managing project metadata

### npx (Node Package eXecute)
npx is a tool that comes with npm (since npm 5.2.0) and helps execute packages:
- Run packages without installing them globally
- Execute packages from your local node_modules
- Automatically install and run packages temporarily

```bash
# Check versions
npm --version
npx --version

# They're bundled together, so both should be available
```

## Installing Packages

### Local Installation (Project-Specific)
```bash
# Install a package and add it to dependencies
npm install package-name
npm install @modelcontextprotocol/sdk

# Install specific version
npm install package-name@1.2.3

# Install and add to devDependencies
npm install --save-dev package-name
npm install -D package-name

# Install multiple packages
npm install package1 package2 package3
```

### Our MCP Server Dependencies
Looking at our hello-world server's package.json:
```json
{
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.17.1"
  }
}
```

This was installed with:
```bash
npm install @modelcontextprotocol/sdk
```

### Global Installation (System-Wide)
```bash
# Install globally (use sparingly)
npm install -g package-name

# Common global packages
npm install -g typescript
npm install -g nodemon
npm install -g @modelcontextprotocol/inspector

# List global packages
npm list -g --depth=0
```

## Understanding package.json and package-lock.json

### package.json: The Blueprint
This file defines your project's dependencies and metadata:

```json
{
  "name": "cdc-mcp",
  "version": "1.0.0",
  "description": "Bernie first MCP",
  "main": "index.js",
  "type": "module",
  "scripts": {
    "start": "node index.js",
    "dev": "nodemon index.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.17.1"
  },
  "devDependencies": {
    "nodemon": "^3.0.0"
  },
  "bin": {
    "cdc-mcp": "./index.js"
  },
  "keywords": ["mcp", "server", "hello-world"],
  "author": "Bernie Pruss",
  "license": "ISC"
}
```

### Key Scripts for MCP Development
```json
{
  "scripts": {
    "start": "node index.js",
    "dev": "nodemon index.js",
    "build": "echo 'No build step needed for simple MCP servers'",
    "test": "node test.js",
    "lint": "eslint *.js"
  }
}
```

Run scripts with: `npm run script-name`

### package-lock.json: The Exact Recipe
This file is automatically generated and ensures everyone gets exactly the same dependency versions:

```json
{
  "name": "cdc-mcp",
  "version": "1.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "cdc-mcp",
      "version": "1.0.0",
      "dependencies": {
        "@modelcontextprotocol/sdk": "^1.17.1"
      }
    },
    "node_modules/@modelcontextprotocol/sdk": {
      "version": "1.17.1",
      "resolved": "https://registry.npmjs.org/@modelcontextprotocol/sdk/-/sdk-1.17.1.tgz",
      "integrity": "sha512-...",
      "dependencies": {
        "zod": "^3.22.4"
      }
    }
  }
}
```

**Important**: Always commit both `package.json` AND `package-lock.json` to version control.

## Common npm Commands

### Installation and Management
```bash
# Install all dependencies from package.json
npm install
npm i  # shorthand

# Install and save to dependencies
npm install package-name
npm install package-name@version

# Install as dev dependency
npm install --save-dev package-name
npm install -D package-name

# Update packages
npm update                    # Update all packages
npm update package-name       # Update specific package

# Remove packages
npm uninstall package-name    # Remove from dependencies
npm uninstall -D package-name # Remove from devDependencies
```

### Information and Inspection
```bash
# List installed packages
npm list                      # Local packages
npm list --depth=0           # Top-level only
npm list -g                  # Global packages

# Show package information
npm info package-name
npm info @modelcontextprotocol/sdk

# Check for outdated packages
npm outdated

# Audit for security vulnerabilities
npm audit
npm audit fix                # Automatically fix issues
```

### Script Execution
```bash
# Run scripts defined in package.json
npm run start
npm run dev
npm run test
npm run build

# Some scripts have shortcuts
npm start     # same as npm run start
npm test      # same as npm run test
```

### MCP Development Workflow
```bash
# 1. Initialize new MCP project
mkdir my-mcp-server
cd my-mcp-server
npm init -y

# 2. Install MCP SDK
npm install @modelcontextprotocol/sdk

# 3. Set up development tools
npm install -D nodemon

# 4. Update package.json for ES modules
# (manually edit to add "type": "module")

# 5. Create your server script
# (create index.js with MCP server code)

# 6. Add npm scripts
# (add start, dev scripts to package.json)

# 7. Test your server
npm run dev
```

## The node_modules Directory

When you run `npm install`, packages are downloaded to the `node_modules` directory:

```
my-mcp-server/
├── package.json
├── package-lock.json
├── index.js
└── node_modules/
    ├── @modelcontextprotocol/
    │   └── sdk/
    │       ├── package.json
    │       ├── server/
    │       └── types/
    ├── zod/
    │   ├── package.json
    │   └── lib/
    └── .bin/
        └── (executable scripts)
```

### Key Points about node_modules:
- **Don't commit to version control**: Add `node_modules/` to `.gitignore`
- **Nested dependencies**: Packages can have their own dependencies
- **Flat structure**: npm tries to flatten the dependency tree when possible
- **Binary scripts**: Executable tools are placed in `node_modules/.bin/`

### .gitignore for MCP Projects
```gitignore
# Dependencies
node_modules/

# Environment files
.env
.env.local

# Logs
*.log
npm-debug.log*

# Runtime data
pids
*.pid
*.seed

# IDE files
.vscode/
.idea/

# OS files
.DS_Store
Thumbs.db
```

## Global vs Local Packages

### Local Packages (Recommended)
- Installed in project's `node_modules/`
- Listed in `package.json`
- Isolated per project
- Consistent across team members

```bash
# Install locally
npm install @modelcontextprotocol/sdk

# Use in code
import { Server } from '@modelcontextprotocol/sdk/server/index.js';
```

### Global Packages (Use Sparingly)
- Installed system-wide
- Available as command-line tools
- Can cause version conflicts
- Harder to manage across team

```bash
# Install globally
npm install -g @modelcontextprotocol/inspector

# Use from command line anywhere
mcp-inspector
```

### When to Use Global vs Local
**Use Global for:**
- Command-line tools you use across projects
- Development utilities like `nodemon`, `typescript`
- MCP inspection tools

**Use Local for:**
- Project dependencies
- Libraries your code imports
- Project-specific tools

## Using npx for Executables

npx solves the problem of running executable packages without global installation:

### Basic npx Usage
```bash
# Run a package without installing
npx cowsay "Hello MCP!"

# Run local package executable
npx nodemon index.js

# Run specific version
npx @modelcontextprotocol/inspector@latest

# Run with arguments
npx typescript-json-schema --help
```

### npx in MCP Development
```bash
# Create new Node.js project quickly
npx create-node-app my-mcp-server

# Run MCP inspector without global install
npx @modelcontextprotocol/inspector

# Use development tools temporarily
npx nodemon --watch index.js --exec "node index.js"

# Test your MCP server
npx @modelcontextprotocol/inspector stdio node index.js
```

### How npx Works
1. Checks if package exists in local `node_modules/.bin/`
2. If not found locally, downloads temporarily to cache
3. Executes the package
4. Cleans up temporary installation

## Publishing and Using Executable Packages

### Making Your MCP Server Executable

Our hello-world server is already set up as an executable package:

```json
{
  "name": "cdc-mcp",
  "bin": {
    "cdc-mcp": "./index.js"
  }
}
```

This creates a command called `cdc-mcp` that runs `./index.js`.

### Local Development and Testing
```bash
# Link your package locally for testing
npm link

# Now you can run it globally
cdc-mcp

# Or test with npx
npx . # runs the main/bin script

# Unlink when done testing
npm unlink
```

### Publishing to npm Registry
```bash
# 1. Create account on npmjs.com
npm adduser

# 2. Login
npm login

# 3. Ensure package name is unique
npm info cdc-mcp  # should return 404 if available

# 4. Publish
npm publish

# 5. Update and republish
npm version patch  # increments version
npm publish
```

### Using Published MCP Server
```bash
# Install globally
npm install -g cdc-mcp

# Or run with npx
npx cdc-mcp

# Or install locally and use in MCP client configuration
npm install cdc-mcp
```

## MCP-Specific Examples

### Example 1: Setting Up a New MCP Server Project
```bash
# Create project directory
mkdir weather-mcp-server
cd weather-mcp-server

# Initialize package.json
npm init -y

# Install MCP SDK
npm install @modelcontextprotocol/sdk

# Install development dependencies
npm install -D nodemon

# Install additional dependencies (example: weather API)
npm install axios dotenv
```

Update package.json:
```json
{
  "name": "weather-mcp-server",
  "version": "1.0.0",
  "type": "module",
  "main": "index.js",
  "bin": {
    "weather-mcp": "./index.js"
  },
  "scripts": {
    "start": "node index.js",
    "dev": "nodemon index.js",
    "test": "node test.js"
  },
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.17.1",
    "axios": "^1.6.0",
    "dotenv": "^16.3.0"
  },
  "devDependencies": {
    "nodemon": "^3.0.0"
  }
}
```

### Example 2: Installing and Using MCP Inspector
```bash
# Run inspector without installing
npx @modelcontextprotocol/inspector

# Test our hello-world server
npx @modelcontextprotocol/inspector stdio node index.js

# Install globally if you use it frequently
npm install -g @modelcontextprotocol/inspector
mcp-inspector stdio node index.js
```

### Example 3: Managing Multiple MCP Server Dependencies
```bash
# Install multiple related packages
npm install @modelcontextprotocol/sdk
npm install express body-parser  # If building HTTP interface
npm install sqlite3             # If using local database
npm install zod                 # For schema validation

# Development tools
npm install -D jest              # Testing framework
npm install -D eslint           # Code linting
npm install -D prettier         # Code formatting
```

Package.json for a complex MCP server:
```json
{
  "name": "advanced-mcp-server",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "start": "node index.js",
    "dev": "nodemon index.js",
    "test": "jest",
    "lint": "eslint *.js",
    "format": "prettier --write *.js",
    "build": "echo 'No build step needed'",
    "prepare": "npm run lint && npm run test"
  },
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.17.1",
    "express": "^4.18.0",
    "sqlite3": "^5.1.6",
    "zod": "^3.22.4"
  },
  "devDependencies": {
    "jest": "^29.7.0",
    "eslint": "^8.54.0",
    "prettier": "^3.1.0",
    "nodemon": "^3.0.0"
  }
}
```

### Example 4: Version Management for MCP Servers
```bash
# Check what version of MCP SDK you're using
npm list @modelcontextprotocol/sdk

# Update to latest version
npm update @modelcontextprotocol/sdk

# Install specific version
npm install @modelcontextprotocol/sdk@1.17.1

# Check for security vulnerabilities
npm audit

# Fix security issues automatically
npm audit fix
```

## Troubleshooting Common Issues

### Problem: "Module not found"
```bash
# Make sure you've installed dependencies
npm install

# Check if package is listed in package.json
npm list package-name

# Reinstall if necessary
npm uninstall package-name
npm install package-name
```

### Problem: "Permission denied" on global install
```bash
# Don't use sudo! Fix npm permissions instead
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'

# Add to your shell profile (.bashrc, .zshrc):
export PATH=~/.npm-global/bin:$PATH

# Or use npx instead of global install
npx package-name
```

### Problem: Conflicting versions
```bash
# Clear npm cache
npm cache clean --force

# Delete node_modules and reinstall
rm -rf node_modules package-lock.json
npm install
```

### Problem: MCP server won't start
```bash
# Check for syntax errors
node --check index.js

# Run with more verbose output
DEBUG=* node index.js

# Check dependencies are installed
npm list @modelcontextprotocol/sdk
```

## Best Practices Summary

1. **Always use package-lock.json**: Commit it to version control
2. **Prefer local over global**: Install packages locally when possible
3. **Use npx for executables**: Avoid global installs of tools
4. **Pin important versions**: Use exact versions for critical dependencies
5. **Regular maintenance**: Keep dependencies updated and secure
6. **Use meaningful scripts**: Add helpful npm scripts to package.json
7. **Document dependencies**: Comment why you need each package

## Next Steps

Now that you understand npm and npx, you're ready to dive into MCP concepts:

1. **MCP Architecture**: How servers communicate with clients
2. **Tool Definitions**: Creating schemas for your MCP tools
3. **Advanced MCP Features**: Resources, prompts, and more

Key takeaways:
- npm manages dependencies and project metadata
- npx runs packages without global installation  
- package.json is your project's blueprint
- Local dependencies are preferable to global ones
- The MCP SDK is just another npm package with excellent tooling

In the next tutorial, we'll explore the Model Context Protocol itself and how to build more sophisticated MCP servers.